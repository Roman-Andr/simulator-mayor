plugins {
    id 'org.jetbrains.kotlin.jvm'
    id 'dev.implario.bundler' version '4.0.1'
}

dependencies {
    compileOnly("ru.cristalix:client-api:10.2-SNAPSHOT")
    implementation("ru.cristalix:client-sdk:10.2-SNAPSHOT")
    implementation("ru.cristalix:uiengine:10.2-SNAPSHOT")
}

tasks.withType(org.jetbrains.kotlin.gradle.tasks.KotlinCompile).all {
    kotlinOptions {
        jvmTarget = "1.8"
    }
}

bundle {
    modName 'construction'
    mainClass 'me.slavita.construction.mod.App'
    author 'Slavita'
    keep('class ru.cristalix.data.** { *; }')
    keep('class ru.cristalix.** { *; }')
}

task upload() {
    doLast {
        ssh.run {
            session(remotes.webServer) {
                put from: project(':mod').tasks.jar.getArchiveFile().get().asFile.path.replace("-raw", "-bundle"), into: "/home/" + System.getenv("CRI_HOST_USERNAME") + "/construction/mods/"
            }
        }
    }
}

jar {
    duplicatesStrategy DuplicatesStrategy.EXCLUDE
    from {
        configurations.runtimeClasspath.collect { it.directory ? it : zipTree(it) }
    }
}